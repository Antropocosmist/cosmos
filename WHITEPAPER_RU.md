# Whitepaper - Cosmos - Интернет блокчейнов

## Сеть распределенных реестров

**Джей Квон** (Jae Kwon) jae@tendermint.com  
**Этан Бухман** (Ethan Buchman) ethan@tendermint.com

**Примечание**: Если вы читаете это на GitHub, значит, мы все еще активно разрабатываем этот документ. Пожалуйста, регулярно проверяйте обновления!

Успех экосистемы с открытым исходным кодом, децентрализованного файлообмена и публичных криптовалют вдохновил понимание того, что децентрализованные интернет-протоколы могут радикально улучшить социально-экономическую инфраструктуру. Мы уже видели специализированные блокчейн-приложения, такие как Bitcoin (криптовалюта), Zerocash (криптовалюта для обеспечения приватности) и универсальные платформы для смарт-контрактов, такие как Ethereum, с бесчисленными децентрализованными приложениями для виртуальной машины Ethereum (EVM), такими как Augur (рынок предсказаний) и TheDAO (инвестиционный клуб).

Однако на сегодняшний день эти блокчейны столкнулись с рядом недостатков, включая огромную неэффективность в потреблении энергии, слабую или ограниченную производительность и незрелые механизмы управления. Предложения по увеличению пропускной способности транзакций Bitcoin, такие как Segregated Witness и BitcoinNG, являются решениями вертикального масштабирования, которые остаются ограниченными производительностью одной физической машины для обеспечения полной аудируемости. Lightning Network может помочь масштабировать объем транзакций Bitcoin, исключая некоторые транзакции из реестра, и хорошо подходит для микроплатежей и приватных платежей, но может быть не подходящим для более общих нужд масштабирования.

Идеальным решением является такое, которое позволяет нескольким параллельным блокчейнам взаимодействовать друг с другом, сохраняя при этом их свойства безопасности. Это оказалось сложной задачей, если не невозможной, с использованием доказательства работы (Proof-of-Work). Например, слияние майнинга позволяет использовать работу, выполненную для защиты основной цепи, на дочерней цепи, но транзакции все равно должны проверяться в порядке каждым узлом, а блокчейн, созданный слиянием майнинга, уязвим для атаки, если большинство хэш-мощности основной цепи не активно участвует в слиянии.

Здесь мы представляем Cosmos — новую архитектуру блокчейн-сети, которая решает все эти проблемы. Cosmos — это сеть многих независимых блокчейнов, называемых зонами. Зоны работают на основе Tendermint Core, который обеспечивает высокопроизводительный, согласованный и безопасный механизм консенсуса, подобный PBFT, где строгие гарантии ответственности за форки удерживают злонамеренных участников от вредоносных действий. Алгоритм консенсуса BFT Tendermint идеально подходит для масштабирования публичных блокчейнов с доказательством доли владения (Proof-of-Stake).


---

## Cosmos Hub

Первой зоной в сети Cosmos является так называемый Cosmos Hub. Cosmos Hub — это криптовалюта с доказательством доли (Proof-of-Stake) и множеством активов, обладающая простым механизмом управления, который позволяет сети адаптироваться и обновляться. Кроме того, Cosmos Hub может расширяться за счет подключения других зон.

Центр и зоны сети Cosmos общаются друг с другом через протокол межблокчейн-коммуникаций (IBC), своего рода виртуальный UDP или TCP для блокчейнов. Токены могут передаваться из одной зоны в другую безопасно и быстро без необходимости в ликвидности для обмена между зонами. Вместо этого все межзоновые передачи токенов проходят через Cosmos Hub, который отслеживает общее количество токенов, принадлежащих каждой зоне. Hub изолирует каждую зону от сбоев в других зонах. Поскольку любой может подключить новую зону к Cosmos Hub, зоны позволяют обеспечивать совместимость с будущими блокчейн-инновациями.

В этом разделе мы описываем протокол консенсуса Tendermint и интерфейс, используемый для создания приложений с его помощью. Более подробная информация представлена в приложении.

В классических алгоритмах византийской отказоустойчивости (BFT) каждый узел имеет одинаковый вес. В Tendermint узлы имеют ненулевую положительную мощность голоса, и узлы с положительной мощностью голоса называются валидаторами. Валидаторы участвуют в протоколе консенсуса, отправляя криптографические подписи, или голоса, чтобы согласовать следующий блок.

Мощности голосов валидаторов определяются на этапе создания блокчейна или изменяются детерминированным образом самим блокчейном в зависимости от приложения. Например, в приложениях с доказательством доли, таких как Cosmos Hub, мощность голоса может зависеть от количества токенов, участвующих в стейкинге в качестве залога.

---


## Протокол консенсуса Tendermint

Tendermint — это частично синхронный BFT-протокол консенсуса, разработанный на основе алгоритма консенсуса DLS. Tendermint известен своей простотой, производительностью и механизмом ответственности за форки. Протокол требует фиксированного известного набора валидаторов, где каждый валидатор идентифицируется по своему открытому ключу. Валидаторы пытаются достичь консенсуса по одному блоку за раз, где блок представляет собой список транзакций. Голосование за консенсус по блоку происходит по раундам. Каждый раунд имеет лидера раунда, или предложителя, который предлагает блок. Затем валидаторы голосуют, поэтапно, за принятие предложенного блока или переход к следующему раунду. Предложитель для раунда выбирается детерминированным образом из упорядоченного списка валидаторов пропорционально их мощности голоса.

Безопасность Tendermint обеспечивается использованием оптимальной византийской отказоустойчивости с помощью голосования супербольшинства (более ⅔) и механизма блокировки. Вместе они гарантируют, что:
- ≥⅓ мощности голосов должно быть византийским (недобросовестным), чтобы нарушить безопасность, где больше двух значений будут утверждены.
- Если какой-либо набор валидаторов успешно нарушит безопасность или даже попытается это сделать, они могут быть идентифицированы протоколом. Это включает как голосование за конфликтующие блоки, так и отправку необоснованных голосов.

Несмотря на сильные гарантии, Tendermint обеспечивает исключительную производительность. В тестах на 64 узлах, распределенных по 7 дата-центрам на 5 континентах, на облачных серверах Tendermint может обрабатывать тысячи транзакций в секунду с задержкой подтверждения порядка одной-двух секунд. Примечательно, что производительность, превышающая тысячу транзакций в секунду, сохраняется даже в условиях агрессивных атак, с валидаторами, которые либо выходят из строя, либо отправляют вредоносные голоса.

---

## Облегчённая безопасность клиента и межблокчейн-коммуникация

Основным преимуществом алгоритма консенсуса Tendermint является упрощенная безопасность легких клиентов, что делает его идеальным кандидатом для мобильных приложений и использования в Интернете вещей. Если клиенту Bitcoin приходится синхронизировать цепочку заголовков блоков и искать ту, которая содержит наибольшее количество доказательств работы, клиенты Tendermint должны лишь отслеживать изменения в наборе валидаторов, а затем проверять более ⅔ предварительных подписей (PreCommits) в последнем блоке, чтобы определить актуальное состояние блокчейна.

Упрощённые доказательства легких клиентов также позволяют реализовать межблокчейн-коммуникации.

Tendermint включает меры защиты от некоторых известных атак, таких как долгоиграющие атаки “ничего на кону” (long-range nothing-at-stake) и цензуру. Эти темы рассматриваются более подробно в приложении.



## Tendermint Core

Алгоритм консенсуса Tendermint реализован в программе, называемой **Tendermint Core**. Tendermint Core — это не зависящий от приложений «движок консенсуса», который может превратить любое детерминированное «черное ящик-приложение» в распределённый блокчейн. Tendermint Core соединяется с блокчейн-приложениями через интерфейс **Application Blockchain Interface** (ABCI). Таким образом, ABCI позволяет программировать блокчейн-приложения на любом языке, а не только на языке, на котором написан движок консенсуса. Кроме того, ABCI делает возможным легко менять уровень консенсуса в любой существующей блокчейн-стеке.

Мы проводим аналогию с известной криптовалютой **Bitcoin**. Bitcoin — это блокчейн криптовалюты, в котором каждый узел поддерживает полностью проверенную базу данных **UTXO** (неизрасходованных выходов транзакций). Если кто-то захочет создать систему, подобную Bitcoin, на основе ABCI, то Tendermint Core будет отвечать за:
- Распространение блоков и транзакций между узлами
- Установление канонического (неизменяемого) порядка транзакций (блокчейна)

Тем временем приложение ABCI будет отвечать за:
- Поддержку базы данных UTXO
- Проверку криптографических подписей транзакций
- Предотвращение транзакций, которые расходуют несуществующие средства
- Позволение клиентам запрашивать базу данных UTXO

Tendermint позволяет разделить дизайн блокчейна, предлагая очень простой API между процессом приложения и процессом консенсуса.

---

## Сеть Cosmos

Cosmos — это сеть независимых параллельных блокчейнов, каждый из которых работает на основе классических алгоритмов консенсуса BFT, таких как Tendermint. Первый блокчейн в этой сети — это **Cosmos Hub**. Cosmos Hub подключается ко многим другим блокчейнам (или зонам) с помощью нового протокола межблокчейн-коммуникаций. Cosmos Hub отслеживает многочисленные типы токенов и ведёт учет общего количества токенов в каждой подключенной зоне. Токены могут передаваться из одной зоны в другую безопасно и быстро без необходимости наличия ликвидного обмена между зонами, так как все межзоновые передачи токенов проходят через Cosmos Hub.

Эта архитектура решает многие проблемы, с которыми сталкивается блокчейн-пространство сегодня, такие как интероперабельность приложений, масштабируемость и бесшовная возможность обновления. Например, зоны, созданные на основе Bitcoin, Go-Ethereum, CryptoNote, ZCash или любой блокчейн-системы, могут быть подключены к Cosmos Hub. Эти зоны позволяют Cosmos масштабироваться до бесконечности для удовлетворения глобального спроса на транзакции. Зоны также отлично подходят для реализации распределённой биржи, которая также будет поддерживаться.

---

## Космос как децентрализованная сеть

Cosmos — это не просто единый распределённый реестр, и Cosmos Hub не является закрытой системой или центром своей вселенной. Мы разрабатываем протокол для открытой сети распределённых реестров, который может стать новой основой для будущих финансовых систем, основанной на принципах криптографии, здравой экономики, теории консенсуса, прозрачности и подотчётности.

Cosmos Hub — это первый публичный блокчейн в сети Cosmos, работающий на основе алгоритма консенсуса Tendermint BFT. Проект Tendermint с открытым исходным кодом был создан в 2014 году для решения проблем скорости, масштабируемости и воздействия на окружающую среду, которые возникают при использовании алгоритма консенсуса доказательства работы (Proof-of-Work) в Bitcoin. Используя и улучшая алгоритмы BFT, разработанные в MIT в 1988 году, команда Tendermint стала первой, кто концептуально продемонстрировал криптовалюту с доказательством доли (Proof-of-Stake), решающую проблему "ничего на кону", которая существовала в таких криптовалютах первого поколения с доказательством доли, как NXT и BitShares1.0.

---

## Быстрая и надёжная валидация транзакций для мобильных клиентов

Сегодня практически все мобильные кошельки Bitcoin используют доверенные серверы для проверки транзакций. Это связано с тем, что алгоритм Proof-of-Work требует ожидания нескольких подтверждений, прежде чем транзакция будет считаться необратимо завершённой. Атаки с двойной тратой (double-spend) уже были продемонстрированы на таких сервисах, как CoinBase.

В отличие от других систем консенсуса блокчейнов, Tendermint предлагает мгновенную и доказуемо безопасную проверку транзакций для мобильных клиентов. Поскольку Tendermint спроектирован так, чтобы исключать возможность форков, мобильные кошельки могут получать мгновенные подтверждения транзакций, что делает возможными доверительные и практичные платежи на смартфонах. Это имеет важные последствия для приложений в сфере Интернета вещей.

## Валидаторы и делегаторы

Валидаторы в Cosmos играют роль, аналогичную майнерам в Bitcoin, но вместо вычисления сложных хэш-функций они используют криптографические подписи для голосования. Валидаторы — это надёжные, специально настроенные машины, отвечающие за подтверждение блоков. Не являющиеся валидаторами участники могут делегировать свои токены (называемые "атомы") любому валидатору, чтобы зарабатывать часть комиссий за блоки и награды в атомах, однако они рискуют потерять свои средства (slashing), если валидатор будет взломан или нарушит протокол. Доказанные гарантии безопасности Tendermint BFT-консенсуса и залоговые депозиты участников — валидаторов и делегаторов — обеспечивают доказуемую и количественно измеримую безопасность для узлов и лёгких клиентов.

## Конституция и система управления

Распределённые публичные реестры должны иметь конституцию и систему управления. В Bitcoin управление и обновления координируются через Bitcoin Foundation и майнинг, но этот процесс медленный. Ethereum разделился на ETH и ETC после хардфорка, вызванного взломом TheDAO, во многом потому, что не было заранее определённого социального контракта или механизма для принятия таких решений.

Валидаторы и делегаторы в Cosmos Hub могут голосовать по предложениям, которые могут автоматически изменять предустановленные параметры системы (например, предел газа блока), координировать обновления, а также голосовать за изменения в читаемой для человека конституции, которая управляет политиками Cosmos Hub. Конституция позволяет обеспечить согласованность среди участников по таким вопросам, как кражи и ошибки (например, как в случае с инцидентом TheDAO), что позволяет более оперативно и чисто решать подобные ситуации.

Каждая зона также может иметь свою собственную конституцию и механизм управления. Например, в Cosmos Hub может быть конституция, которая обеспечивает неизменяемость на уровне Hub (без откатов, кроме случаев исправления багов реализации узлов Cosmos Hub), в то время как каждая зона может устанавливать свои собственные правила по поводу откатов.

---

## Новая модель децентрализации и масштабируемости

Здесь описана новая модель децентрализации и масштабируемости. Cosmos — это сеть множества блокчейнов, работающих на основе Tendermint. В то время как существующие предложения направлены на создание «единого блокчейна» с глобальной общей очередью транзакций, Cosmos позволяет нескольким блокчейнам работать параллельно друг с другом, сохраняя при этом возможность взаимодействия.

В основе сети Cosmos находится **Cosmos Hub**, который управляет множеством независимых блокчейнов, называемых зонами (иногда их называют "шарды" по аналогии с техникой масштабирования баз данных, известной как "шардинг"). Постоянный поток последних подтверждений блоков из зон, размещаемый в Hub, позволяет Hub отслеживать состояние каждой зоны. Точно так же каждая зона отслеживает состояние Hub (но зоны не отслеживают друг друга, кроме как косвенно через Hub). Пакеты информации затем передаются из одной зоны в другую, публикуя доказательства Merkle как подтверждение того, что информация была отправлена и получена. Этот механизм называется **межблокчейн-коммуникацией (IBC)**.

Любая из зон может сама стать хабом, формируя ацикличный граф, но для простоты здесь описывается конфигурация, где есть только один хаб и много зон, не являющихся хабами.

---

## Cosmos Hub как центральный реестр


**Cosmos Hub** — это блокчейн, который хранит распределённый реестр с множеством активов, где токены могут принадлежать отдельным пользователям или самим зонам. Эти токены могут перемещаться из одной зоны в другую в специальном IBC-пакете, называемом «пакет токенов». Hub отвечает за сохранение глобального инварианта общего количества каждого токена в зонах. IBC-транзакции с пакетами токенов должны быть подтверждены отправителем, Hub и принимающими блокчейнами.

Так как Cosmos Hub играет роль центрального реестра для всей системы, его безопасность имеет первостепенное значение. В то время как каждая зона может быть блокчейном на базе Tendermint с минимальным количеством валидаторов (возможно, даже меньше 4), Hub должен быть защищен глобально децентрализованным набором валидаторов, способным выдержать самые серьёзные атаки, такие как разделение континентальной сети или атака, спонсируемая государством.


## Зоны Cosmos

Зона в сети Cosmos — это независимый блокчейн, который обменивается IBC-сообщениями с Hub. С точки зрения Hub, зона представляет собой мультиактивный динамический счёт с мультиподписью, который может отправлять и получать токены, используя IBC-пакеты. Подобно счёту в криптовалюте, зона не может перевести больше токенов, чем у неё есть, но может получать токены от других. Зона может быть назначена «источником» одного или нескольких типов токенов, что даёт ей право увеличивать предложение этих токенов.

Атомы Cosmos Hub могут использоваться в стейкинге валидаторами зоны, подключённой к Hub. Хотя атаки с двойной тратой на этих зонах приведут к «слэшингу» атомов с помощью системы ответственности за форки Tendermint, зона, где более ⅔ голосов византийские (недобросовестные), может зафиксировать некорректное состояние. Cosmos Hub не проверяет и не выполняет транзакции, зафиксированные на других зонах, поэтому пользователи несут ответственность за отправку токенов в зоны, которым они доверяют.

В будущем система управления Cosmos Hub может принять предложения по улучшению Hub, учитывающие сбои в зонах. Например, исходящие переводы токенов из некоторых (или всех) зон могут быть ограничены, чтобы позволить экстренное приостановление транзакций в зонах (временную остановку переводов токенов) при обнаружении атаки.

---

## Коммуникация между Hub и зонами

Теперь рассмотрим, как Hub и зоны взаимодействуют друг с другом. Например, если есть три блокчейна: «Zone1», «Zone2» и «Hub», и необходимо, чтобы «Zone1» отправила пакет, предназначенный для «Zone2», проходя через «Hub». Чтобы переместить пакет с одного блокчейна на другой, доказательство должно быть размещено на принимающей цепи. Доказательство показывает, что отправляющая цепь опубликовала пакет для предполагаемого назначения. Для того чтобы принимающая цепь могла проверить это доказательство, она должна быть в курсе заголовков блоков отправляющей цепи. Этот механизм аналогичен тому, что используется в сайдчейнах, где две взаимодействующие цепи должны быть в курсе друг друга через двусторонний поток доказательств существования данных (транзакций).

Протокол IBC может быть естественным образом определён с использованием двух типов транзакций: **IBCBlockCommitTx** и **IBCPacketTx**. 

---

## Децентрализованные биржи

Также обсуждается возможность создания децентрализованных бирж на основе блокчейнов. Биржи могут быть построены как на базе атомарных межцепочечных транзакций (AXC), так и как полностью распределённые системы, где пользователи могут отправлять лимитные ордера и не находиться в сети, в то время как торговля будет осуществляться автоматически на блокчейне.

---


## Распределенные биржи и Cosmos

Централизованные биржи создают глубокие стаканы лимитных ордеров и таким образом привлекают больше трейдеров. Ликвидность порождает еще больше ликвидности, и в мире бирж есть мощный сетевой эффект (или, по крайней мере, эффект победителя, который забирает большую часть рынка). На сегодняшний день лидером среди криптовалютных бирж является Poloniex с 24-часовым объемом в $20 млн, а на втором месте — Bitfinex с 24-часовым объемом в $5 млн. В условиях таких сильных сетевых эффектов маловероятно, что децентрализованные биржи на основе AXC смогут завоевать объемы, сопоставимые с централизованными биржами.

Чтобы децентрализованная биржа могла конкурировать с централизованной биржей, она должна поддерживать глубокие стаканы с лимитными ордерами. Только распределенная биржа на блокчейне может это обеспечить.

Tendermint предоставляет дополнительные преимущества благодаря более быстрому подтверждению транзакций. Приоритизируя быструю финализацию (подтверждение) транзакций без жертвования согласованностью, зоны в Cosmos могут быстро завершать транзакции — как для ордеров на бирже, так и для токенов IBC, перемещаемых между зонами.

С учетом текущего состояния криптовалютных бирж отличным приложением для Cosmos является распределенная биржа (известная как Cosmos DEX). Пропускная способность транзакций и задержка финализации могут быть сопоставимы с централизованными биржами. Трейдеры могут отправлять лимитные ордера, которые будут выполнены без необходимости для обеих сторон оставаться в сети. А с помощью Tendermint, Cosmos Hub и IBC трейдеры могут перемещать средства на биржу и с биржи в другие зоны с высокой скоростью.

---

## Cosmos как мост для других криптовалют

Привилегированная зона может выступать в качестве источника токенов другой криптовалюты. Мост (bridge) схож с отношениями между хабом и зоной Cosmos: обе стороны должны быть в курсе последних блоков друг друга для проверки доказательств того, что токены были перемещены с одной цепи на другую. Зона-мост в сети Cosmos синхронизируется как с Hub, так и с другой криптовалютой. Использование промежуточной зоны позволяет сохранить логику Hub простой и независимой от других стратегий консенсуса блокчейнов, таких как майнинг в Bitcoin на основе доказательства работы (Proof-of-Work).

Каждый валидатор зоны-моста будет работать на блокчейне на базе Tendermint с специальным приложением ABCI для моста, а также будет полным узлом «оригинального» блокчейна. Когда на исходном блокчейне добываются новые блоки, валидаторы зоны-моста приходят к соглашению о зафиксированных блоках, подписывая и обмениваясь локальными представлениями о текущем состоянии цепи исходного блокчейна.

---

## Мосты для Ethereum и Bitcoin

В случае Ethereum зона-мост может использовать тот же набор валидаторов, что и Cosmos Hub. На стороне Ethereum (оригинал) смарт-контракт моста позволит держателям ETH отправлять свои средства в зону-мост, отправив их на смарт-контракт моста на Ethereum. Как только эфир будет получен смарт-контрактом моста, его нельзя будет вывести, если соответствующий IBC-пакет не будет получен от зоны-моста. Смарт-контракт моста отслеживает набор валидаторов зоны-моста, который может быть идентичен набору валидаторов Cosmos Hub.

В случае Bitcoin концепция аналогична, за исключением того, что вместо одного смарт-контракта моста каждый UTXO будет контролироваться множественными подписями P2SH. Из-за ограничений системы P2SH подписанты не могут быть идентичны набору валидаторов Cosmos Hub.

---

## Риски моста

Основным риском при использовании мостов является нечестный набор валидаторов. Если ≥⅓ валидаторов ведёт себя недобросовестно, это может привести к форку, который позволит вывести эфир из смарт-контракта моста на Ethereum, оставив bridged-ether в зоне-мосте. Ещё хуже: если более ⅔ валидаторов окажутся недобросовестными, они могут украсть эфир у тех, кто отправил его в смарт-контракт моста, отклонившись от оригинальной логики моста.

Эти проблемы могут быть решены проектированием моста с полной подотчётностью. Например, все IBC-пакеты (как от хаба, так и от исходного блокчейна) могут требовать подтверждения от зоны-моста таким образом, чтобы все переходы состояния зоны-моста можно было эффективно оспорить и проверить либо в хабе, либо в смарт-контракте моста на исходном блокчейне. Hub и исходный блокчейн должны позволять валидаторам зоны-моста вносить залоги, и переводы токенов из смарт-контракта моста должны откладываться (и период отвязки залогов должен быть достаточно долгим), чтобы дать независимым аудиторам возможность оспорить любые действия.

Мы оставляем проектирование и реализацию этой системы на будущее как предложение по улучшению Cosmos, которое будет принято через систему управления Cosmos Hub.

## Масштабируемость Ethereum

Решение проблемы масштабирования — это открытая задача для Ethereum. В настоящее время узлы Ethereum обрабатывают каждую транзакцию и хранят все состояния.

Поскольку Tendermint может фиксировать блоки намного быстрее, чем система доказательства работы Ethereum, зоны EVM на базе консенсуса Tendermint с использованием "bridged-ether" могут предоставлять более высокую производительность для блокчейнов Ethereum. Кроме того, хотя механика пакетов IBC в Cosmos и Cosmos Hub не позволяет выполнять произвольную логику смарт-контрактов, она может использоваться для координации перемещения токенов между смарт-контрактами Ethereum, работающими в разных зонах, что даёт основу для масштабирования Ethereum с использованием шардинга.

---

## Возможности использования Cosmos для различных криптовалют

Зоны Cosmos могут выполнять произвольную логику приложений, которая задаётся в начале жизни зоны и потенциально может обновляться с течением времени через управление. Такая гибкость позволяет зонам Cosmos действовать как мосты к другим криптовалютам, таким как Ethereum или Bitcoin, а также разрешает создание производных версий этих блокчейнов с использованием той же кодовой базы, но с различными наборами валидаторов и начальным распределением токенов.

Это позволяет многим существующим криптовалютным платформам, таким как Ethereum, Zerocash, Bitcoin, CryptoNote и другим, использовать Tendermint Core как более производительный консенсусный механизм в общей сети, открывая большие возможности для взаимодействия между платформами.

---


## Децентрализованные биржи на основе блокчейнов

В дополнение к возможности использовать Cosmos для взаимодействия между различными криптовалютами, система также может служить основой для децентрализованных бирж. Одним из сценариев является создание распределённых бирж с книгами ордеров, что может быть улучшением по сравнению с существующими централизованными криптовалютными биржами, которые часто подвергаются взломам.

## Использование Cosmos для государственных и корпоративных систем

Зоны Cosmos также могут использоваться в качестве блокчейн-версий корпоративных и государственных систем, где отдельные элементы определённого сервиса, которые традиционно управляются организацией или группой организаций, могут быть реализованы как приложения ABCI в определённой зоне. Это позволит зоне наследовать безопасность и интероперабельность публичной сети Cosmos, не теряя при этом контроль над самим сервисом. Таким образом, Cosmos может предложить лучшее из обоих миров для организаций, желающих использовать блокчейн-технологии, но при этом не готовых полностью передать контроль сторонним распределённым системам.

---

## Недостатки и риски консенсусных алгоритмов

Некоторые утверждают, что проблема с консенсусными алгоритмами, ориентированными на согласованность, такими как Tendermint, заключается в том, что любая сеть, где нет одной части с более чем ⅔ голосов (например, если ⅓ узлов выйдет из строя), полностью остановит консенсус. Архитектура Cosmos может помочь смягчить эту проблему, используя глобальный хаб с региональными автономными зонами, где голосовая мощность каждой зоны распределена в пределах одного географического региона. Например, города или регионы могут управлять своими собственными зонами, сохраняя общий хаб (например, Cosmos Hub), что позволит продолжать муниципальную деятельность, даже если хаб временно остановится из-за сетевого разделения.

---

## Космос как новая основа для финансовых систем

Проект Cosmos основан на принципах открытости, прозрачности и устойчивости, и стремится создать новую основу для будущих финансовых систем. В отличие от других блокчейн-систем, где консенсус или масштабируемость часто являются узкими местами, Cosmos предлагает гибкую, децентрализованную и масштабируемую архитектуру, которая позволяет разным блокчейнам взаимодействовать, сохраняя независимость и безопасность.

---


## Решение проблемы с именами (Name Resolution)

Одним из первых блокчейнов, пытавшихся решить проблему разрешения имен, был **NameCoin**, который адаптировал блокчейн Bitcoin. К сожалению, этот подход имел несколько проблем. С NameCoin мы можем проверить, что, например, @satoshi был зарегистрирован с определенным открытым ключом в какой-то момент в прошлом, но не можем узнать, был ли этот публичный ключ недавно обновлен, если только не загрузим все блоки с момента последнего обновления этого имени. Это связано с ограничением модели Merkle-деревьев транзакций в Bitcoin, где только транзакции (но не изменяемое состояние приложения) включены в Merkle-дерево блока. Это позволяет нам доказать существование, но не позволяет доказать отсутствие последующих обновлений имени. Таким образом, мы не можем точно узнать последнее значение имени, не доверяя полному узлу или не загружая весь блокчейн.

Даже если бы в NameCoin было реализовано Merkle-дерево для поиска, его зависимость от доказательства работы (Proof-of-Work) делает верификацию для легких клиентов проблематичной. Легкие клиенты должны загрузить полную копию заголовков всех блоков в блокчейне (или хотя бы все заголовки с момента последнего обновления имени). Это означает, что требования к пропускной способности возрастают линейно с увеличением времени.

С использованием Tendermint все, что нам нужно — это последний хэш блока, подписанный кворумом валидаторов (с учётом мощности их голосов), и доказательство Merkle текущего значения, связанного с именем. Это позволяет осуществлять быструю, краткую и безопасную верификацию имени для легких клиентов.

В Cosmos мы можем взять эту концепцию и развить её дальше. Каждая зона регистрации имён в Cosmos может иметь связанное доменное имя верхнего уровня (TLD), такое как ".com" или ".org", и каждая зона регистрации имён может иметь свои собственные правила управления и регистрации.

---

## Atom: Нативный токен Cosmos Hub

Хотя Cosmos Hub является мультиактивным распределённым реестром, существует особый нативный токен, называемый **атом**. Атомы — это единственные токены для стейкинга в Cosmos Hub. Атомы дают право их владельцам голосовать, валидировать или делегировать свои голоса другим валидаторам. Подобно эфиру в Ethereum, атомы также могут использоваться для оплаты комиссий за транзакции, что помогает предотвращать спам в сети. Дополнительные инфляционные атомы и комиссии за транзакции распределяются среди валидаторов и делегаторов, которые делегировали свои голоса валидаторам.

---

## Первоначальное распределение атомов

Первоначальное распределение токенов атомов и валидаторов на этапе запуска будет следующим:
- Участники фандрайзинга Cosmos получат 75%
- Ведущие доноры — 5%
- Фонд Cosmos Network — 10%
- ALL IN BITS, Inc — 10%

С момента запуска и далее ⅓ от общего количества атомов будет ежегодно вознаграждаться привязанным валидаторам и делегаторам.

---

## Ограничения валидаторов

В отличие от Bitcoin или других блокчейнов на основе доказательства работы, блокчейн на базе Tendermint становится медленнее при увеличении числа валидаторов из-за увеличения сложности обмена сообщениями. К счастью, мы можем поддерживать достаточное количество валидаторов для создания надёжного глобально распределённого блокчейна с очень быстрым временем подтверждения транзакций. А по мере увеличения пропускной способности, объёмов хранения и параллельной вычислительной мощности в будущем, мы сможем поддерживать ещё больше валидаторов.

На момент запуска максимальное количество валидаторов будет установлено на уровне 100, и это количество будет увеличиваться на 13% ежегодно в течение 10 лет, пока не достигнет 300 валидаторов.

---

## Становление валидатором

Владельцы атомов, которые не являются валидаторами, могут стать валидаторами, подписав и отправив транзакцию **BondTx**. Количество атомов, предоставляемых в качестве залога, должно быть ненулевым. Любой может стать валидатором в любое время, за исключением случаев, когда размер текущего набора валидаторов превышает максимальное количество разрешённых валидаторов. В этом случае транзакция будет действительна только если количество атомов больше, чем количество эффективных атомов, удерживаемых наименьшим валидатором (эффективные атомы включают делегированные атомы). Когда новый валидатор заменяет существующего валидатора, все атомы и делегированные атомы последнего переходят в состояние отвязки.

## Наказания для валидаторов

На валидаторов должно налагаться наказание за любое умышленное или неумышленное отклонение от санкционированного протокола. Некоторые доказательства могут быть приняты немедленно, например, двойная подпись на одной и той же высоте и раунде или нарушение правила предвыборной блокировки (prevote-the-lock). Такое доказательство приведёт к потере валидатором своего статуса и срезанию (slashing) его залоговых атомов, а также его пропорциональной доли токенов в резервном пуле — совокупность этих активов называется «ставкой» валидатора.

Иногда валидаторы могут быть недоступны из-за сбоев в региональной сети, отключения электроэнергии или по другим причинам. Если в любой момент времени в пределах заданного количества блоков (ValidatorTimeoutWindow) валидатор не участвовал в подтверждении больше разрешённого количества раз (ValidatorTimeoutMaxAbsent), этот валидатор станет неактивным, и 1% его ставки будет срезано (ValidatorTimeoutPenalty).

## Координация в случае атак

В ситуациях, когда работа Cosmos Hub остановлена из-за выхода из строя коалиции валидаторов с ≥⅓ голосов, или в случаях, когда коалиция с ≥⅓ голосов цензурирует доказательства злонамеренного поведения, хаб должен восстановиться через жёсткую форк-реорганизацию с предложением реорганизации (reorg-proposal). Валидаторы Cosmos Hub могут принять любые типы токенов или их комбинации в качестве комиссии за обработку транзакций. Каждый валидатор может установить свой собственный курс обмена и выбирать, какие транзакции обрабатывать, при условии, что не превышен лимит газа блока (BlockGasLimit). Собранные комиссии (за вычетом резервного налога, если он установлен) перераспределяются среди привязанных участников в пропорции к их привязанным атомам.

---

## Система вознаграждений и резервный налог

Из собранных комиссий 2% (по умолчанию) будет поступать в резервный фонд, увеличивая его объём и повышая безопасность и ценность сети Cosmos. Эти средства также могут распределяться в соответствии с решениями, принятыми системой управления.

Делегаторы, которые делегируют свои голоса валидаторам, платят комиссию делегированному валидатору. Комиссия может быть установлена каждым валидатором.

Безопасность Cosmos Hub — это функция безопасности его валидаторов и выбора делегаторов. Чтобы стимулировать раннее выявление уязвимостей, Cosmos Hub поощряет хакеров публиковать успешные эксплойты через транзакцию **ReportHackTx**, которая сообщает: «Этот валидатор был взломан. Пожалуйста, отправьте вознаграждение на этот адрес». После такого взлома валидатор и делегаторы становятся неактивными, и 5% атомов у всех участников будет срезано, а 5% атомов будет направлено на вознаграждение хакера. Валидатор может восстановить оставшиеся атомы, используя свой резервный ключ.

---

## Механизм управления Cosmos

Cosmos Hub управляется децентрализованной организацией, которая требует хорошо определённого механизма управления для координации различных изменений в блокчейне, таких как изменение переменных параметров системы, обновление программного обеспечения и конституционные поправки.

Все валидаторы обязаны голосовать по всем предложениям. Неучастие в голосовании может привести к автоматической деактивации валидатора на определённый срок (AbsenteeismPenaltyPeriod).

Делегаторы автоматически наследуют голос делегированного валидатора, но могут переопределить его вручную. Непривязанные атомы не дают права голоса.

---


## Механизм предложений и голосования

Каждое предложение требует депозита минимального количества токенов **MinimumProposalDeposit**, который может состоять из одной или нескольких комбинаций токенов, включая атомы. По каждому предложению голосующие могут принять решение о возврате депозита. Если более половины голосующих решат не возвращать депозит (например, если предложение было спамом), депозит отправляется в резервный фонд, за исключением атомов, которые сжигаются.

Для каждого предложения голосующие могут проголосовать следующим образом:
- "Да" (Yea)
- "Да с силой" (YeaWithForce)
- "Нет" (Nay)
- "Нет с силой" (NayWithForce)
- Воздержаться (Abstain)

Для принятия предложения требуется строгое большинство голосов "Да" или "Да с силой" (или "Нет" или "Нет с силой" для отклонения). Однако ⅓+ голосов может наложить вето на решение большинства, проголосовав «с силой». Если строгое большинство было отклонено, все участники голосования наказываются потерей **VetoPenaltyFeeBlocks** (по умолчанию эквивалент одного дня блоков) комиссий (за исключением налогов), а сторона, наложившая вето на решение большинства, будет дополнительно наказана потерей **VetoPenaltyAtoms** (по умолчанию 0,1%) своих атомов.

Любой из параметров, описанных здесь, может быть изменён с помощью принятия предложения о изменении параметров **ParameterChangeProposal**.

Атомы могут быть инфлированы, а средства из резервного фонда израсходованы с помощью принятия предложения о вознаграждении **BountyProposal**.

Все остальные предложения, такие как предложения по обновлению протокола, будут координироваться с помощью общих текстовых предложений **TextProposal**.

---

## Важные инновации в области консенсуса и масштабируемости

В последние несколько лет в области консенсуса и масштабируемости блокчейнов было сделано множество инноваций. Этот раздел предоставляет краткий обзор некоторых важных достижений.

**Консенсус в условиях присутствия злонамеренных участников** — это проблема, которая восходит к началу 1980-х годов, когда Лесли Лампорт ввёл термин "византийский сбой", описывающий произвольное поведение процесса, отличное от запланированного. Ранние решения были найдены для синхронных сетей, где существует верхний предел задержки сообщений, но их практическое применение было ограничено сильно контролируемыми средами, такими как системы управления самолётами или дата-центры, синхронизированные с использованием атомных часов. Лишь в конце 90-х годов был представлен алгоритм **Практической византийской отказоустойчивости (PBFT)**, который стал стандартом для частично синхронных сетей, способным терпеть до ⅓ процессов, ведущих себя произвольно.

---

## Преимущества Tendermint над PBFT

Основным преимуществом алгоритма консенсуса Tendermint по сравнению с PBFT является его упрощенная и улучшенная структура, частично благодаря использованию блокчейнов. Блоки Tendermint должны фиксироваться по порядку, что устраняет сложность и накладные расходы, связанные с PBFT. В таких системах, как Cosmos, нет необходимости позволять фиксировать блок N+i, если блок N ещё не зафиксирован. Если причина, по которой блок N не зафиксирован, связана с проблемами пропускной способности, то передача большего количества голосов за блоки N+i не поможет.

Кроме того, пакетная обработка транзакций в блоках позволяет регулярно выполнять хеширование состояния приложения с использованием Merkle-деревьев, что позволяет быстрее фиксировать транзакции для лёгких клиентов и быстрее осуществлять межблокчейн-коммуникации.

---

## Заключение

Tendermint был разработан для обеспечения консенсуса с высокой производительностью и безопасности, подходящего как для публичных, так и для частных блокчейнов. Cosmos использует Tendermint, чтобы предложить децентрализованную сеть взаимосвязанных блокчейнов, которые могут масштабироваться и взаимодействовать, создавая основу для новой глобальной финансовой системы. Преимущества Tendermint и Cosmos включают в себя:

1. **Масштабируемость**: Возможность обрабатывать тысячи транзакций в секунду с низкими задержками.
2. **Интероперабельность**: Блокчейны могут обмениваться данными и активами через протокол межблокчейн-коммуникаций (IBC).
3. **Безопасность**: Tendermint использует византийскую отказоустойчивость для обеспечения безопасности сети.
4. **Гибкость**: Возможность подключать независимые блокчейны к хабу, сохраняя их уникальные механизмы консенсуса и управления.
5. **Устойчивость**: Tendermint обеспечивает согласованность в условиях различных сетевых ошибок и атак.

Cosmos предоставляет уникальную архитектуру для создания децентрализованных приложений, способных взаимодействовать друг с другом. Это открывает новые возможности для глобальных финансовых систем, обеспечивая безопасность, масштабируемость и открытость. С развитием экосистемы Cosmos и созданием новых зон будет возможно взаимодействие между существующими блокчейнами, такими как Bitcoin и Ethereum, а также разработка совершенно новых приложений, которые используют преимущества этого децентрализованного подхода.

### Приложение A: Tendermint и PBFT

Как обсуждалось ранее, Tendermint — это византийская отказоустойчивая система консенсуса. Основное различие между Tendermint и PBFT заключается в упрощённой структуре обработки транзакций и фиксации блоков. Tendermint фокусируется на достижении консенсуса относительно одного блока за раз, тогда как PBFT требует многократных коммуникаций между узлами для согласования одного состояния системы. Tendermint упрощает эту схему, значительно сокращая накладные расходы на коммуникации и, следовательно, увеличивая производительность сети.

### Приложение B: Примеры использования

- **Мобильные платежи**: Благодаря быстрым подтверждениям и легким клиентам Tendermint идеально подходит для мобильных платежей и Интернета вещей.
- **Децентрализованные биржи**: Cosmos может поддерживать децентрализованные биржи с книгами ордеров, что делает возможными торги без необходимости доверять централизованным платформам.
- **Государственные системы**: Зоны могут использоваться для создания блокчейн-систем управления, которые унаследуют безопасность и децентрализацию сети Cosmos.
- **Мосты для других блокчейнов**: Cosmos поддерживает мосты для взаимодействия с другими блокчейнами, такими как Bitcoin и Ethereum, предоставляя инфраструктуру для перемещения активов между ними.

---

Перевод совершил: Chat GPT

Правки внёс: [Владимир Понимающий](https://github.com/Antropocosmist)
